===============
Networking
===============

Premessa: l'MCS, essendo un server che va esposto su internet, deve risiedere in una DMZ e *non deve avere alcun tipo di visibilità verso le LAN locali*.

---------------
MCS
---------------

Porte in ingresso da Internet a MCS:

+----------------+-------------+---------------------------------------+---------------------------------------------------------------+
| Protocollo     | Porte       |              Servizio                 |                   Note e limitazioni                          |
+================+=============+=======================================+===============================================================+
|   UDP/TCP      |     3478    |            Stun/turn server           |                                                               |
+----------------+-------------+---------------------------------------+---------------------------------------------------------------+
|     UDP        | 10000–20000 |             RTP SRTP DTLS             |                                                               |
+----------------+-------------+---------------------------------------+---------------------------------------------------------------+
|   UDP/TCP      |     1194    | Server OpenVPN per tunnel VPN da TVox | Limitabile ai soli IP pubblici dei TVox se conosciuti         |
+----------------+-------------+---------------------------------------+---------------------------------------------------------------+
|     TCP        |      80     |         HTTP redirect to HTTPS        |                                                               |
+----------------+-------------+---------------------------------------+---------------------------------------------------------------+
|     TCP        |     443     |    HTTPS TVox WebClient / Teams App   |                                                               |
+----------------+-------------+---------------------------------------+---------------------------------------------------------------+
|     TCP        |      22     |                  SSH                  | Solo per gli IP di amministrazione e IP pubblici Telenia      |
|                |             |                                       | |br| (79.8.39.108/32 e 93.39.91.217/32)                       |
+----------------+-------------+---------------------------------------+---------------------------------------------------------------+

Porte in uscita da MCS a Internet:

+------------+------------+-------------------------+-----------------------------------------------------------------+
| Protocollo |  Porte     |         Servizio        |                        Note e limitazioni                       |
+============+============+=========================+=================================================================+
|     TCP    |   443      |          HTTPS          | Richiesto per:                                                  |
|            |            |                         |                                                                 |
|            |            |                         | * Controllo aggiornamenti e licenza verso server AWS            |
|            |            |                         | * Integrazione Let’s Encrypt                                    |
+------------+------------+-------------------------+-----------------------------------------------------------------+
|   UDP/TCP  |   53       |           DNS           |                                                                 |
+------------+------------+-------------------------+-----------------------------------------------------------------+
|     TCP    | 25,465,587 | Invio e-mail di allarme | Limitabile all’IP del servizio di posta e alla porta utilizzata |
+------------+------------+-------------------------+-----------------------------------------------------------------+
|     UDP    |     123    |        NTP              |                                                                 |
+------------+------------+-------------------------+-----------------------------------------------------------------+

Va garantito l'accesso a Telenia dai nostri ip pubblici (79.8.39.108/32 e 93.39.91.217/32)

----
TVox
----

Porte in uscita da TVox a MCS:

+------------+-------------+------------------+--------------------+
| Protocollo |    Porte    |     Servizio     | Note e limitazioni |
+============+=============+==================+====================+
|   UDP/TCP  |     3478    | Stun/turn server |                    |
+------------+-------------+------------------+--------------------+
|     UDP    | 10000–20000 |   RTP SRTP DTLS  |                    |
+------------+-------------+------------------+--------------------+
|   UDP/TCP  |     1194    |  tunnel OpenVPN  |                    |
+------------+-------------+------------------+--------------------+

Porte in uscita da TVox a Internet:

+------------+---------------+---------------------------------+------------------------------------------------------------------+
| Protocollo |     Porte     |             Servizio            |                        Note e limitazioni                        |
+============+===============+=================================+==================================================================+
|     TCP    |    443,2197   | Apple Push Notification Service |                                                                  |
+------------+---------------+---------------------------------+------------------------------------------------------------------+
|     TCP    | 443,5228-5230 |            Google FCM           |                                                                  |
+------------+---------------+---------------------------------+------------------------------------------------------------------+
|     TCP    |      443      |              HTTPS              | Richiesto per controllo aggiornamenti e licenza verso server AWS |
+------------+---------------+---------------------------------+------------------------------------------------------------------+
|   UDP/TCP  |       53      |               DNS               |                                                                  |
+------------+---------------+---------------------------------+------------------------------------------------------------------+
|     TCP    |  25,465,587   |     Invio e-mail di allarme     |  Limitabile all’IP del servizio di posta e alla porta utilizzata |
+------------+---------------+---------------------------------+------------------------------------------------------------------+
|     UDP    |     123       |               NTP               |                                                                  |
+------------+---------------+---------------------------------+------------------------------------------------------------------+

Porte in ingresso da Internet a TVox:

+------------+-------------+---------------+---------------------------------------------------------------------------------------------+
| Protocollo |    Porte    |    Servizio   |                                      Note e limitazioni                                     |
+============+=============+===============+=============================================================================================+
|   UDP/TCP  |     5060    |      SIP      |                                      Solo per trunk SIP                                     |
+------------+-------------+---------------+---------------------------------------------------------------------------------------------+
|     TCP    |     5061    |      TLS      |                                      Solo per trunk SIP                                     |
+------------+-------------+---------------+---------------------------------------------------------------------------------------------+
|     UDP    | 10000-20000 | RTP SRTP DTLS |                                      Solo per trunk SIP                                     |
+------------+-------------+---------------+---------------------------------------------------------------------------------------------+
|     TCP    |      22     |      SSH      | Solo per gli IP di amministrazione e IP pubblici Telenia                                    |
|            |             |               | |br| (79.8.39.108/32 e 93.39.91.217/32)                                                     |
+------------+-------------+---------------+---------------------------------------------------------------------------------------------+
|     TCP    |     443     |     HTTPS     | Solo per gli IP di amministrazione e IP pubblici Telenia                                    |
|            |             |               | |br| (79.8.39.108/32 e 93.39.91.217/32)                                                     |
+------------+-------------+---------------+---------------------------------------------------------------------------------------------+

Nota: di default per il TVox è corretto utilizzare una regola “Deny all” per tutte le connessioni in ingresso da Internet tranne per i seguenti casi:

- utilizzo di trunk con provider SIP via Internet
- accesso alla console Web e SSH per amministrazione

--------------------
Postazioni operatori
--------------------

Se è necessario limitare in uscita il traffico delle postazioni degli operatori è necessario consentire almeno le seguenti regole:

Da WebClient a MCS:

+------------+-------------+----------------------+--------------------+
| Protocollo |    Porte    |       Servizio       | Note e limitazioni |
+============+=============+======================+====================+
|     TCP    |     443     | HTTPS TVox WebClient |                    |
+------------+-------------+----------------------+--------------------+
|   TCP/UDP  |     3478    |   Stun/Turn server   |                    |
+------------+-------------+----------------------+--------------------+
|     UDP    | 10000-20000 |     RTP SRTP DTLS    |                    |
+------------+-------------+----------------------+--------------------+